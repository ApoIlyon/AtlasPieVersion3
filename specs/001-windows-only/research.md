# Research Log: Windows-only AtlasPie Cleanup

## Decision 1: Методика выявления Linux/macOS артефактов
- **Decision**: Использовать комбинированный подход — статический список известных путей (commands/linux_*, scripts/*.sh, *.desktop и т.д.) + автоматизированный поиск по ключевым словам (`rg -i "linux|macos|darwin|systemd|xdg|launchctl|appimage|deb|gnome|wayland|gtk"`).
- **Rationale**: Жёстко заданный список покрывает очевидные каталоги, а поиск по ключам ловит вольные упоминания в тексте. Двойная проверка снижает риск пропуска.
- **Alternatives considered**:
  - *Ручной обзор дерева файлов*: слишком медленно и зависимо от внимательности.
  - *Только ключевые слова*: не ловит «молчащие» бинарные/скриптовые файлы без строковых признаков.

## Decision 2: Политика удаления условной компиляции в Rust
- **Decision**: Свести `src-tauri/src` к единственному Windows-пути: удалить `#[cfg(target_os)]` ветки, объединить разрозненные файлы и оставить только то, что реально требуется Win32 API + tauri core.
- **Rationale**: Требования запрещают заглушки и альтернативные реализации; проще поддерживать один код-путь и облегчить аудит зависимостей (`cargo tree`).
- **Alternatives considered**:
  - *Сохранить cfg, но пометить как deprecated*: оставляет лишние ветки, повышает риск регрессий, нарушает цель задачи.
  - *Выделить общий модуль + windows модуль*: усложняет структуру без практического выигрыша для единственной платформы.

## Decision 3: Работа с frontend/локализациями
- **Decision**: Удалить проверки `isLinux`, `isMac`, `process.platform` и скорректировать все строки локализаций, чтобы они упоминали только Windows. Дополнительно прогнать `scripts/validate-i18n.mjs` после правок.
- **Rationale**: UI не должен обещать недоступный функционал; автоматический lint по локализациям предотвращает пропуск ключей.
- **Alternatives considered**:
  - *Оставить «серые» тексты*: вводит пользователей в заблуждение.
  - *Заменить на «Windows (только)» с остатками проверок*: усложняет код и не соответствует требованию «без process.platform».

## Decision 4: Очистка зависимостей и конфигов
- **Decision**: Пересобрать список зависимостей через `cargo tree --edge features`, `pnpm ls` и проверить `tauri.conf.json5`. Удалить плагины вроде `tauri-plugin-autostart`, `macos-private-api`, Linux-only crates, а из `tauri.conf` оставить только секцию `windows`.
- **Rationale**: Централизованный аудит исключает скрытые фичи; проверка деревьев пакетов показывает транзитивные зависимости.
- **Alternatives considered**:
  - *Частичный аудит только Cargo*: оставит мусор в npm-/Tauri-конфигах.
  - *Удаление по списку без проверки дерева*: можно забыть о транзитивных зависимостях или продублированных feature-флагах.

## Decision 5: Обновление CI/тестов
- **Decision**: Сократить GitHub Actions до одного workflow на `windows-latest` (msbuild/msi). Для Playwright оставить единственный проект `windows-chromium`, удалить Linux/macOS проекты и связанные снапшоты. Проверки `cargo check`, `pnpm test`, `npx playwright test --project=windows-chromium` входят в финальную валидацию.
- **Rationale**: Требования указывают на полный отказ от других ОС; единый пайплайн упрощает сопровождение и ускоряет фидбек.
- **Alternatives considered**:
  - *Оставить ubuntu runner для lint*: нарушает цель проекта и заставляет обслуживать ненужную инфраструктуру.
  - *Сохранять Playwright проекты, но пометить skip*: файлы продолжат существовать и противоречат требованию «удалить тесты».
